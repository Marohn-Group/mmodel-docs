
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Creating a model graph &#8212; MModel 0.3.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Building a model" href="tutorial_model.html" />
    <link rel="prev" title="Changelog" href="changelog.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">MModel 0.3.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Changelog
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorial
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Creating a model graph
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tutorial_model.html">
   Building a model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tutorial_modifier.html">
   Modifying model and node
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tutorial_subgraph.html">
   Modifying a subgraph
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API Guideline
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="api_handler.html">
   Handler API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api_modifier.html">
   Modifier API
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ref_graph.html">
   Graph
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ref_model.html">
   Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ref_handler.html">
   Handler
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ref_modifier.html">
   Modifier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ref_filter.html">
   Filter
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/tutorial_graph.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-a-graph">
   Define a graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-node-objects">
   Set node objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#name-and-docstring">
   Name and docstring
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mutability">
   Mutability
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Creating a model graph</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-a-graph">
   Define a graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-node-objects">
   Set node objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#name-and-docstring">
   Name and docstring
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mutability">
   Mutability
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="creating-a-model-graph">
<h1>Creating a model graph<a class="headerlink" href="#creating-a-model-graph" title="Permalink to this headline">#</a></h1>
<p>A directed acyclic graph (DAG) is a directed graph without any cycles.
The model graphs in <code class="docutils literal notranslate"><span class="pre">mmodel</span></code> are based on the DAG, where each node represents
an execution step, and each edge represents the data flow from one callable
to another. DAG structure allows us to create model graphs with nonlinear
nodes.</p>
<section id="define-a-graph">
<h2>Define a graph<a class="headerlink" href="#define-a-graph" title="Permalink to this headline">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ModelGraph</span></code> class is the main graph class to establish a model graph.
The class inherits from <code class="docutils literal notranslate"><span class="pre">networkx.DiGraph</span></code>, which is compatible with all
<code class="docutils literal notranslate"><span class="pre">networkx</span></code> operations
(see <a class="reference external" href="https://networkx.org/documentation/stable/">documentation</a>).
To create and modify the graph,
see the documentation for adding
<a class="reference external" href="https://networkx.org/documentation/stable/tutorial.html#nodes">nodes</a>
and adding <a class="reference external" href="https://networkx.org/documentation/stable/tutorial.html#edges">edges</a></p>
<p>Aside from the <code class="docutils literal notranslate"><span class="pre">networkx</span></code> operations,
<code class="docutils literal notranslate"><span class="pre">mmodel</span></code> provides <code class="docutils literal notranslate"><span class="pre">add_grouped_edge</span></code> and <code class="docutils literal notranslate"><span class="pre">add_grouped_edges_from</span></code> to add edges.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mmodel</span> <span class="kn">import</span> <span class="n">ModelGraph</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">ModelGraph</span><span class="p">()</span>

<span class="n">G</span><span class="o">.</span><span class="n">add_grouped_edge</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>

<span class="c1"># equivalent to</span>
<span class="c1"># G.add_edge(&#39;a&#39;, &#39;b&#39;)</span>
<span class="c1"># G.add_edge(&#39;a&#39;, &#39;c&#39;)</span>
</pre></div>
</div>
<p>Similarly, with multiple grouped edges</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grouped_edges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]),</span>
<span class="p">]</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">ModelGraph</span><span class="p">()</span>

<span class="n">G</span><span class="o">.</span><span class="n">add_grouped_edge_from</span><span class="p">(</span><span class="n">grouped_edges</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">ModelGraph</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="mi">2</span> <span class="n">edges</span>
</pre></div>
</div>
</section>
<section id="set-node-objects">
<h2>Set node objects<a class="headerlink" href="#set-node-objects" title="Permalink to this headline">#</a></h2>
<p>Each node in the graph represents an execution, and the edges represents the data
flow. Therefore we need to link the node to its execution method. In <code class="docutils literal notranslate"><span class="pre">mmodel</span></code>
a node object is a combination of:</p>
<ol class="arabic simple">
<li><p>callable, function or function-like (“func”)</p></li>
<li><p>callable return variable names (“returns”)</p></li>
<li><p>callable parameter</p></li>
</ol>
<p>For linking the node object to the node, two methods are provided:
<code class="docutils literal notranslate"><span class="pre">set_node_object</span></code> and <code class="docutils literal notranslate"><span class="pre">set_node_objects_from</span></code>.
The latter accepts a list of node objects.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">G</span><span class="o">.</span><span class="n">set_node_object</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">test_func</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span>

<span class="c1"># or with multiple node objects</span>
<span class="n">node_objects</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">test_func</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">test_func</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]),</span>
<span class="p">]</span>

<span class="n">G</span><span class="o">.</span><span class="n">set_node_objects_from</span><span class="p">(</span><span class="n">node_objects</span><span class="p">)</span>
</pre></div>
</div>
<p>In most cases, only the callable and the returns are needed because the parameters
can be extracted from the function signature. However, there are several cases
the method does not work:</p>
<ol class="arabic simple">
<li><p>python’s built-in functions</p></li>
<li><p>functions without clear signature (<code class="docutils literal notranslate"><span class="pre">numpy</span></code> universal functions)</p></li>
<li><p>parameters that are different from defined parameter names</p></li>
</ol>
<p>In these case 1 and 2, a newly defined function with clear parameter information
is recommended.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The object is stored as a node attribute and the function signature
(<cite>inspect.Signature</cite>) is stored. The parameter values are converted
to signature objects.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mmodel</span></code> determines function parameters using <code class="docutils literal notranslate"><span class="pre">inspect.signature</span></code>, for
callables that are not compatible with the function, the “params” argument
is required.</p>
<p>The name of the parameters that pass through each edge is determined and stored
in the edge attribute “val”.</p>
</section>
<section id="name-and-docstring">
<h2>Name and docstring<a class="headerlink" href="#name-and-docstring" title="Permalink to this headline">#</a></h2>
<p>Since the graph represents a model, we want to define the name and docstring
of the model. They are stored as the graph attributes and can be defined during
the graph definition and after. The graph attribute of graph G stores the
attributes in a dictionary format.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># during graph definition</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">ModelGraph</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test graph&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;add two floats, a and b, returns c&quot;</span><span class="p">)</span>

<span class="c1"># after definition</span>
<span class="n">G</span><span class="o">.</span><span class="n">graph</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ModelGraph Example&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">ModelGraph</span> <span class="n">named</span> <span class="s1">&#39;ModelGraph Example&#39;</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">nodes</span> <span class="ow">and</span> <span class="mi">0</span> <span class="n">edges</span>

<span class="n">add</span> <span class="n">two</span> <span class="n">floats</span><span class="p">,</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">b</span><span class="p">,</span> <span class="n">returns</span> <span class="n">c</span>
</pre></div>
</div>
</section>
<section id="mutability">
<h2>Mutability<a class="headerlink" href="#mutability" title="Permalink to this headline">#</a></h2>
<p>The graph object is mutable. A shallow or deepcopy might be needed to create a copy
of the graph.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># shallow copy</span>
<span class="n">G</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span> <span class="c1"># deep copy</span>
</pre></div>
</div>
<p>For more ways to interact with ModelGraph, see <a class="reference internal" href="ref_graph.html"><span class="doc">graph reference</span></a>.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="changelog.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Changelog</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="tutorial_model.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Building a model</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Peter Sun<br/>
  
      &copy; Copyright 2022, Peter Sun.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>